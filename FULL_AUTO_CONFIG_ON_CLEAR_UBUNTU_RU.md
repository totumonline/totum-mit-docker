## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞ —á–∏—Å—Ç—É—é Ubuntu 20.04 –≤ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–º —Ä–µ–∂–∏–º–µ (—Ä–∞—Å—Å—á–∏—Ç–∞–Ω–æ –Ω–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é –∫–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏—é)

#### –ï—Å–ª–∏ –≤–∞–º –Ω—É–∂–µ–Ω –ø–æ—à–∞–≥–æ–≤—ã–π —Ä–∞–∑–±–æ—Ä –¥–µ–π—Å—Ç–≤–∏–π –≤—ã–ø–æ–ª–Ω—è–µ–º—ã—Ö –≤ —ç—Ç–æ–π –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ ‚Äî [—Å–º–æ—Ç—Ä–∏—Ç–µ –∑–¥–µ—Å—å](https://github.com/totumonline/totum-mit-docker/blob/main/FULL_CONFIG_ON_CLEAR_UBUNTU_RU.md)


–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ –¥–æ–º–µ–Ω –∏ –Ω–∞–ø—Ä–∞–≤—å—Ç–µ –µ–≥–æ –Ω–∞ `ip` –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞. –í –∫—Ä–∞–π–Ω–µ–º —Å–ª—É—á–∞–µ –º–æ–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–µ–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –¥–æ–º–µ–Ω–∞ –æ—Ç–∫—Ä—ã–≤ –ø–æ `ip` —Å–µ—Ä–≤–µ—Ä–∞. –¢–∞–∫–∂–µ –≤—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–æ–º–µ–Ω—ã 3 –∏ 4 —É—Ä–æ–≤–Ω—è.



–£–¥–æ—Å—Ç–æ–≤–µ—Ä—å—Ç–µ—Å—å, —á—Ç–æ –≤–∞—à —Å–µ—Ä–≤–µ—Ä –Ω–∏—á–µ–≥–æ –Ω–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∏ –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç –Ω–∞–ø—Ä–∏–º–µ—Ä –≤—ã–ø–æ–ª–Ω–∏–≤:

```
ps aux | grep -i apt
```

–í –æ—Ç–≤–µ—Ç–µ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–Ω–∞ —Å—Ç—Ä–æ–∫–∞!



–û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ –Ω—É–∂–Ω—ã–π –≤–∞–º —á–∞—Å–æ–≤–æ–π –ø–æ—è—Å `tzselect`:

```
tzselect
```

1. –í—ã –¥–æ–ª–∂–Ω—ã –≤–≤–µ—Å—Ç–∏ –Ω–æ–º–µ—Ä –æ–±–ª–∞—Å—Ç–∏ –∏ –Ω–∞–∂–∞—Ç—å Enter. –ó–∞—Ç–µ–º –ø–æ—è–≤–∏—Ç—Å—è —Å–ø–∏—Å–æ–∫ —Å—Ç—Ä–∞–Ω.
2. –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ, –Ω—É–∂–Ω–æ –≤–≤–µ—Å—Ç–∏ –Ω–æ–º–µ—Ä —Å—Ç—Ä–∞–Ω—ã.
3. –ü–æ—è–≤–∏—Ç—Å—è —Å–ø–∏—Å–æ–∫ –≥–æ—Ä–æ–¥–æ–≤. –í–≤–æ–¥–∏–º –Ω–æ–º–µ—Ä –≥–æ—Ä–æ–¥–∞.
4. –í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –≤—ã —Å–º–æ–∂–µ—Ç–µ —É–≤–∏–¥–µ—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ –≤–∞—à–µ–π –≤—Ä–µ–º–µ–Ω–Ω–æ–π –∑–æ–Ω—ã.



–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ, –∑–∞–º–µ–Ω–∏—Ç–µ `YOU_TIMEZONE` –∏ `YOU_PASS_FOR_BASE` –Ω–∞ –≤–∞—à–∏ –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```
DOCKERTIMEZONE=YOU_TIMEZONE && DOCKERBASEPASS=YOU_PASS_FOR_BASE
```

–ù–∞–ø—Ä–∏–º–µ—Ä:

```
DOCKERTIMEZONE=Europe/Madrid && DOCKERBASEPASS=totumsuperbasepass
```



–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Å–µ, —Å–æ–∑–¥–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –ø—Ä–∞–≤–∞ –ø–∞–ø–∫–∞–º –∏ —Ñ–∞–π–ª–∞–º (–≤—ã–ø–æ–ª–Ω—è–µ–º –ø–æ–ª–Ω–æ—Å—Ç—å—é –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π):

```
apt update && apt -y install git nano htop && apt update && apt -y install ca-certificates curl gnupg lsb-release && curl -fsSL https://download.docker.com/linux/ubuntu/gpg | gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg && echo "deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable" | tee /etc/apt/sources.list.d/docker.list > /dev/null && apt-get update && apt-get -y install docker-ce docker-ce-cli containerd.io && curl -L "https://github.com/docker/compose/releases/download/v2.2.2/docker-compose-linux-x86_64" -o /usr/local/bin/docker-compose && chmod +x /usr/local/bin/docker-compose && useradd -s /bin/bash -m totum && groupadd -g 201608 totum_d && groupadd -g 201609 totum_c && usermod -aG 201608 totum  && usermod -aG 201609 totum && usermod -aG docker totum && git clone https://github.com/totumonline/totum-mit-docker.git /home/totum/totum-mit-docker && chown totum:totum /home/totum/totum-mit-docker && cd /home/totum/totum-mit-docker && chown -R 201609:201609 . && chmod 777 ./exim_log && chown -R 201608:201608 ./totum && chmod 600 .env && sed -i "s:Europe/London:${DOCKERTIMEZONE}:g" /home/totum/totum-mit-docker/.env /home/totum/totum-mit-docker/nginx_fpm_conf/totum_fpm.conf && sed -i "s:TotumBasePass:${DOCKERBASEPASS}:g" /home/totum/totum-mit-docker/.env && docker-compose up -d
```



#### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º Totum:

- –æ—Ç–∫—Ä–æ–π—Ç–µ `url` (–µ—Å–ª–∏ –Ω–µ –ø–æ–¥–∫–ª—é—á–∞–ª–∏ `url` ‚Äî `ip` —Å–µ—Ä–≤–µ—Ä–∞), –∫–æ—Ç–æ—Ä—ã–π –≤—ã –∞–¥—Ä–µ—Å–æ–≤–∞–ª–∏ –Ω–∞ —ç—Ç–æ—Ç —Å–µ—Ä–≤–µ—Ä –≤ –±—Ä–∞—É–∑–µ—Ä–µ;

- –∑–∞–ø–æ–ª–Ω–∏—Ç–µ:

    - —è–∑—ã–∫ —É—Å—Ç–∞–Ω–æ–≤–∫–∏;

    - –ø–∞—Ä–æ–ª—å –±–∞–∑—ã (–µ—Å–ª–∏ –º–µ–Ω—è–ª–∏);

    - –ø–∞—Ä–æ–ª—å —Å—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è totum, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ;

    - email —Å—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è totum;

    - –∂–º–µ–º –°–æ–∑–¥–∞—Ç—å;

–° —ç—Ç–æ–≥–æ –º–æ–º–µ–Ω—Ç–∞ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ `http` –ø–æ –≤–∞—à–µ–º—É –¥–æ–º–µ–Ω—É –∏–ª–∏ –ø–æ `ip`.

#### –í–∞–∂–Ω–æ:

–ï—Å–ª–∏ –≤—ã –µ—â–µ –Ω–µ –∞–¥—Ä–µ—Å–æ–≤–∞–ª–∏ –¥–æ–º–µ–Ω, —Ç–æ –º–æ–∂–Ω–æ –æ—Ç–∫—Ä—ã—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ –ø–æ `IP` —Å–µ—Ä–≤–µ—Ä–∞ –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç—å —É—Å—Ç–∞–Ω–æ–≤–∫—É, –Ω–æ –≤ —ç—Ç–æ–º —Å–ª—É—á–∞–µ –ø–æ—Å–ª–µ —Ç–æ–≥–æ –∫–∞–∫ –≤—ã –ø–æ–¥–∫–ª—é—á–∏—Ç–µ –¥–æ–º–µ–Ω –≤–∞–º –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç:

- –æ—Ç–∫—Ä—ã—Ç—å `nano /home/totum/totum-mit-docker/totum/Conf.php` 

    - –Ω–∞–π—Ç–∏ –∏ –∑–∞–º–µ–Ω–∏—Ç—å IP –Ω–∞ –∞–¥—Ä–µ—Å –¥–æ–º–µ–Ω–∞ `78.98.345.12` `>` `totum.monster`

- –µ—Å–ª–∏ –≤—ã –∑–∞–≥—Ä—É–∂–∞–ª–∏ —Ñ–∞–π–ª—ã –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å –ø–∞–ø–∫—É (–∑–∞–º–µ–Ω–∏—Ç–µ `YOU_IP` –∏ `YOU_DOMAIN`):

```
mv /home/totum/totum-mit-docker/totum/fls/YOU_IP  /home/totum/totum-mit-docker/totum/fls/YOU_DOMAIN
```

–î–ª—è –ø—Ä–∏–º–µ—Ä–∞:

```
mv /home/totum/totum-mit-docker/totum/fls/78.98.345.12  /home/totum/totum-mit-docker/totum/fls/totum.monster
```



### –°–æ–∑–¥–∞–µ–º –∏ –ø–æ–¥–∫–ª—é—á–∞–µ–º –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç SSL

**–ú–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –≤—ã –∞–¥—Ä–µ—Å–æ–≤–∞–ª–∏ —Ä–∞–±–æ—Ç–∞—é—â–∏–π –¥–æ–º–µ–Ω!**

–ó–∞–º–µ–Ω–∏—Ç–µ `YOU_EMAIL` –∏ `YOU_DOMAIN` –Ω–∞ –≤–∞—à–∏ –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```
CERTBOTEMAIL=YOU_EMAIL && CERTBOTDOMAIN=YOU_DOMAIN
```

–ù–∞–ø—Ä–∏–º–µ—Ä:

```
CERTBOTEMAIL=totum@totum.online && CERTBOTDOMAIN=totum.monster
```


–¢–µ–ø–µ—Ä—å –≤—ã–ø–æ–ª–Ω—è–µ–º (–≤—ã–ø–æ–ª–Ω—è–µ–º –ø–æ–ª–Ω–æ—Å—Ç—å—é –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π):

```
CONTAINERID=$(docker ps -f name=ttm-totum --quiet) && docker exec -i $CONTAINERID sudo certbot register --email $CERTBOTEMAIL --agree-tos --no-eff-email && docker exec -i $CONTAINERID sudo certbot certonly -d $CERTBOTDOMAIN && SSLDOMAIN=$(find /home/totum/totum-mit-docker/certbot/etc_letsencrypt/live/* -type d) && SSLDOMAIN=$(basename $SSLDOMAIN) && sed -i "s:YOU_DOMAIN:${SSLDOMAIN}:g" /home/totum/totum-mit-docker/nginx_fpm_conf/totum_nginx_SSL.conf && echo "SSLON=_SSL" >> /home/totum/totum-mit-docker/.env && cd /home/totum/totum-mit-docker/ && docker-compose up --force-recreate -d
```


### DKIM –¥–ª—è –ø–∏—Å–µ–º

–î–ª—è —Ç–æ–≥–æ, —á—Ç–æ –±—ã –ø–∏—Å—å–º–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–ª–∏—Å—å –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–º –¥–æ–º–µ–Ω–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ (–≤—ã–ø–æ–ª–Ω—è–µ–º –ø–æ–ª–Ω–æ—Å—Ç—å—é –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π):

```
cd /home/totum/totum-mit-docker/dkim && openssl genrsa -out private.pem 1024 && openssl rsa -pubout -in private.pem -out public.pem && openssl pkey -in private.pem -out domain.key && chmod 644 domain.key && chown -R 201609:201609 domain.key && cat public.pem | tr -d '\n' > key_for_dkim.txt && sed -i "s:-----BEGIN PUBLIC KEY-----::g" key_for_dkim.txt && sed -i "s:-----END PUBLIC KEY-----::g" key_for_dkim.txt && DKIMKEY=$(cat key_for_dkim.txt) && echo -e "\nReplace YOU_DOMAIN and add TXT record for you domain:\n\nmail._domainkey.YOU_DOMAIN.\n\nv=DKIM1; k=rsa; t=s; p=PUBLIC_KEY\n\nReplace YOU_SERVER_IP and add TXT record for SPF:\n\nv=spf1 ip4:YOU_SERVER_IP ~all\n\n" > TXT_record_for_domain.txt && sed -i "s:PUBLIC_KEY:${DKIMKEY}:g" TXT_record_for_domain.txt && cat TXT_record_for_domain.txt && cd /home/totum/totum-mit-docker/ && docker-compose up --force-recreate -d
```

–î–∞–ª–µ–µ –≤–∞–º –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –¥–≤–µ TXT –∑–∞–ø–∏—Å–∏ –¥–ª—è –≤–∞—à–µ–≥–æ –¥–æ–º–µ–Ω–∞ —Å–æ–≥–ª–∞—Å–Ω–æ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –Ω–∞ —ç–∫—Ä–∞–Ω–µ üëÜ

**–£ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ —Ö–æ—Å—Ç–µ—Ä–æ–≤ 25 –ø–æ—Ä—Ç –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–∏—Å–µ–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –¥–ª—è –±–æ—Ä—å–±—ã —Å–æ —Å–ø–∞–º–æ–º ‚Äî —É—Ç–æ—á–Ω–∏—Ç–µ —É –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Ö–æ—Å—Ç—É—Ä–∞, —á—Ç–æ –≤–∞–º –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å, —á—Ç–æ –±—ã –æ–Ω–∏ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª–∏ –≤–∞–º –æ—Ç–ø—Ä–∞–≤–∫—É –ø–∏—Å–µ–º.**


### –ö–∞–∫ –ø–æ–ø–∞—Å—Ç—å –≤–Ω—É—Ç—Ä—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–æ–Ω—Å–æ–ª—å–Ω–æ–π —É—Ç–∏–ª–∏—Ç–µ Totum

–í—ã–ø–æ–ª–Ω–∏—Ç–µ:

```
CONTAINERID=$(docker ps -f name=ttm-totum --quiet) && docker exec -ti $CONTAINERID /bin/bash
```

–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∫–æ–º–∞–Ω–¥—ã –∫–æ–Ω—Å–æ–ª—å–Ω–æ–π —É—Ç–∏–ª–∏—Ç—ã:

```
bin/totum list
```

–ß—Ç–æ –±—ã –≤—ã–π—Ç–∏:

```
exit
```

